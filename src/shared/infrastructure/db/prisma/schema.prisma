generator client {
  provider = "prisma-client-js"
}


datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}



model CreditAccount {
  id               Int                @id @default(autoincrement())
  creditCode       String             @unique
  type             CreditAccountType
  originalCredits  Float
  originalMoney    Float
  availableCredits Float
  availableMoney   Float
  email            String
  dateCreated      DateTime
  dateExpired      DateTime
  treatmentCount   Int?               
  discountPercentage Float?           
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  transactions CreditTransaction[]
}

model CreditTransaction {
  id  Int @id @default(autoincrement())
  creditAccount CreditAccount @relation(fields: [creditAccountId], references: [id], onDelete: Cascade)
  creditAccountId Int
  type TransactionType
  credits Float
  money Float
  note String?
  createdAt        DateTime           @default(now())
  

  fromTransfer CreditTransfer[] @relation("FromTransaction")
  toTransfer CreditTransfer[] @relation("ToTransaction")
}

model CreditTransfer {
  id Int @id @default (autoincrement())
  fromTransaction CreditTransaction @relation("FromTransaction", fields: [fromTransactionId], references: [id], onDelete: Cascade)
  fromTransactionId Int
  toTransaction CreditTransaction @relation("ToTransaction", fields: [toTransactionId], references: [id], onDelete: Cascade)
  toTransactionId Int
  createdAt DateTime @default(now())
}

enum CreditAccountType {
  GIFT_CARD
  PREPAID_CARD
}

enum TransactionType {
  PURCHASE
  USAGE
  NULLIFICATION
  TRANSFER_IN
  TRANSFER_OUT
  REFUND
}

